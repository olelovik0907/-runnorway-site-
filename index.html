<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="assets/logo-32.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/logo-180.png" />
  <link rel="manifest" href="site.webmanifest" />
  <link rel="canonical" href="https://www.runnorway.no/" />

  <title>RunNorway – Finn alle løp i Norge. Ett sted. Én kalender.</title>
  <meta name="description" content="RunNorway. Finn alle løp i Norge. Ett sted. Én kalender. Samler løp, treninger og løypeinformasjon over hele Norge." />
  <meta name="robots" content="index,follow" />
  <meta property="og:title" content="RunNorway – Finn alle løp i Norge. Ett sted. Én kalender." />
  <meta property="og:description" content="RunNorway samler løp, treninger og løypeinformasjon over hele Norge. Ett sted. Én kalender." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.runnorway.no/" />
  <meta property="og:image" content="assets/logo-512.png" />
  <meta name="theme-color" content="#116D6B" />

  <!-- Stil -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="/assets/style.css"><!-- valgfri egen stil (kan fjernes) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

  <style>
    :focus{ outline: 3px solid rgba(243,195,22,.6); outline-offset: 2px; }
    :root{ --brand-teal:#116D6B; --brand-gold:#F3C316; }
    .btn-brand{background:var(--brand-gold);} .btn-brand:hover{background:#d6aa10;}
    .link-brand:hover{color:var(--brand-gold);} .text-brand{color:var(--brand-teal);} .bg-brand{background:var(--brand-teal);}
    body{ font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji','Segoe UI Emoji'; }
  </style>

  <!-- Strukturert data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "RunNorway",
    "url": "https://www.runnorway.no/",
    "logo": "https://www.runnorway.no/assets/logo-512.png",
    "sameAs": []
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "RunNorway",
    "url": "https://www.runnorway.no/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://www.runnorway.no/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
</head>

<body class="antialiased text-slate-800">
  <!-- Toppnavigasjon -->
  <header class="sticky top-0 z-50 bg-white/80 backdrop-blur shadow-sm">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex h-16 items-center justify-between">
        <a href="#home" class="flex items-center gap-2 font-bold text-xl">
          <img src="assets/logo-48.png" alt="RunNorway logo" class="h-8 w-auto" loading="lazy" />
          <span>RunNorway</span>
        </a>
        <nav class="hidden md:flex items-center gap-8 text-sm font-medium">
          <a href="#arrangementer" class="link-brand">Arrangementer</a>
          <a href="#vaer" class="link-brand">Vær</a>
          <a href="admin.html" class="link-brand">Legg inn løp</a>
          <a href="#kontakt" class="link-brand">Kontakt</a>
        </nav>
        <button id="menuBtn" class="md:hidden rounded-full p-2 hover:bg-slate-100" aria-label="Åpne meny" aria-expanded="false">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-6 w-6" fill="currentColor"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
      </div>
    </div>
    <div id="mobileMenu" class="md:hidden hidden border-t bg-white">
      <div class="mx-auto max-w-7xl px-4 py-3 grid gap-3 text-sm font-medium">
        <a href="#arrangementer" class="py-2">Arrangementer</a>
        <a href="#vaer" class="py-2">Vær</a>
        <a href="admin.html" class="py-2">Legg inn løp</a>
        <a href="#kontakt" class="py-2">Kontakt</a>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section id="home" class="relative overflow-hidden bg-cover bg-center" style="background-image: url('assets/Løper langs Atlanterhavsveien.png');">
          <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 400" preserveAspectRatio="none">
        <defs>
          <linearGradient id="grad" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0%" stop-color="#F3C316"/>
            <stop offset="100%" stop-color="#ffffff"/>
          </linearGradient>
        </defs>
        <path d="M0,200 C240,120 480,280 720,200 C960,120 1200,40 1440,160 L1440,400 L0,400 Z" fill="url(#grad)"/>
      </svg>
    </div>
    <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-28 sm:py-36 text-center text-white">
      <img src="assets/logo-192.png" alt="RunNorway" class="mx-auto h-20 mb-6" loading="lazy" />
      <h1 class="text-4xl sm:text-6xl font-extrabold leading-tight">Finn alle løp i Norge</h1>
      <p class="mt-4 text-lg sm:text-xl text-slate-100/90">Ett sted. Én kalender. Planlegg sesongen på minutter.</p>
      <div class="mt-8 flex flex-wrap justify-center gap-3">
        <a href="#arrangementer" class="rounded-full btn-brand px-6 py-3 text-white font-semibold">Se arrangementer</a>
        <a href="admin.html" class="rounded-full bg-white/90 px-6 py-3 text-slate-900 font-semibold hover:bg-white">Legg inn ditt løp</a>
      </div>
    </div>
  </section>

  <!-- Arrangementer -->
  <section id="arrangementer" class="py-16 bg-slate-50">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl sm:text-4xl font-bold mb-4">Kommende arrangementer</h2>

      <div class="inline-flex rounded-2xl bg-white shadow p-1 mb-4" role="tablist" aria-label="Visning">
        <button id="tab-list" class="px-4 py-2 rounded-xl font-semibold" role="tab" aria-selected="true" aria-controls="panel-list">Liste</button>
        <button id="tab-cal" class="px-4 py-2 rounded-xl font-semibold" role="tab" aria-selected="false" aria-controls="panel-cal">Kalender</button>
        <button id="tab-map" class="px-4 py-2 rounded-xl font-semibold" role="tab" aria-selected="false" aria-controls="panel-map">Kart</button>
      </div>

      <div class="rounded-2xl bg-white shadow p-4 sm:p-6">
        <div class="grid gap-3 sm:grid-cols-4 items-end">
          <label class="sm:col-span-2">
            <span class="text-sm font-semibold">Søk</span>
            <input id="q" class="mt-1 w-full rounded-xl border px-3 py-2" placeholder="Søk på navn eller sted" />
          </label>
          <label>
            <span class="text-sm font-semibold">Måned</span>
            <select id="month" class="mt-1 w-full rounded-xl border px-3 py-2">
              <option value="">Alle</option>
            </select>
          </label>
          <label>
            <span class="text-sm font-semibold">Region</span>
            <select id="region" class="mt-1 w-full rounded-xl border px-3 py-2">
              <option value="">Alle</option>
            </select>
          </label>
        </div>
        <div class="mt-4 flex flex-wrap gap-3">
          <button id="resetFilters" class="rounded-full border px-4 py-2 font-semibold hover:bg-slate-50">Nullstill</button>
          <button id="togglePast" class="rounded-full btn-brand px-4 py-2 text-white font-semibold" aria-pressed="false">Vis tidligere løp</button>
        </div>
      </div>

      <div id="eventsSummary" class="mt-4 text-slate-600"></div>

      <!-- Liste -->
      <div id="panel-list" role="tabpanel" aria-labelledby="tab-list" class="mt-4">
        <div id="eventsGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6" aria-live="polite"></div>
        <p id="eventsEmpty" class="hidden text-slate-600">Ingen arrangementer matcher filtrene.</p>
      </div>

      <!-- Kalender -->
      <div id="panel-cal" role="tabpanel" aria-labelledby="tab-cal" hidden class="mt-6">
        <div class="flex items-center justify-between mb-3">
          <button id="calPrev" class="rounded-full border px-3 py-2 font-semibold hover:bg-slate-50">Forrige</button>
          <h3 id="calTitle" class="text-xl font-bold"></h3>
          <button id="calNext" class="rounded-full border px-3 py-2 font-semibold hover:bg-slate-50">Neste</button>
        </div>
        <div id="calendarGrid" class="grid grid-cols-7 gap-2"></div>
      </div>

      <!-- Kart -->
      <div id="panel-map" role="tabpanel" aria-labelledby="tab-map" hidden class="mt-6">
        <div id="map" class="w-full h-[520px] rounded-2xl overflow-hidden shadow"></div>
        <p class="mt-2 text-sm text-slate-600">Tips: klikk på markørene for info og påmeldingslenke.</p>
      </div>
    </div>
  </section>

  <!-- Vær fast seksjon (kan stå eller fjernes – du har uansett "Se vær" per løp) -->
  <section id="vaer" class="py-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl sm:text-4xl font-bold mb-4">Værmelding (eksempel: Oslo)</h2>
      <iframe
        src="https://www.pent.no/Oslo"
        width="100%"
        height="600"
        style="border:none; border-radius:10px;"
        title="Vær fra Pent.no">
      </iframe>
    </div>
  </section>

  <!-- Kontakt -->
  <section id="kontakt" class="py-16 bg-slate-50">
    <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl sm:text-4xl font-bold">Kontakt oss</h2>
      <p class="mt-2 text-slate-700">Spørsmål om løp, samarbeid eller presse? Send oss e-post – vi svarer raskt.</p>
      <div class="mt-6 flex flex-wrap items-center gap-4 text-slate-800">
        <a class="rounded-full btn-brand px-6 py-3 text-white font-semibold" href="mailto:post@runnorway.no">post@runnorway.no</a>
        <a class="rounded-full border px-6 py-3 font-semibold hover:bg-slate-50" href="https://www.instagram.com/" target="_blank" rel="noopener">Følg oss på Instagram</a>
      </div>
    </div>
  </section>

  <footer class="py-10 bg-slate-900 text-white text-center">
    <p>© <span id="year"></span> RunNorway</p>
  </footer>

  <!-- Fallback-data dersom arrangementer.json mangler -->
  <script id="events-seed" type="application/json">[
    {"title":"Bergen City Mile","date":"2025-04-12","location":"Bergen sentrum","region":"Vestland","distances":["5K","10K","Familie"],"image":"https://images.unsplash.com/photo-1552674605-db6ffd4facb0?q=80&w=1200&auto=format&fit=crop","signup_url":"#","details_url":"#"},
    {"title":"Oslo FjordRun 10K","date":"2025-05-03","location":"Bygdøy, Oslo","region":"Oslo","distances":["10K"],"image":"https://images.unsplash.com/photo-1541963694-3f4e68f1b7a1?q=80&w=1200&auto=format&fit=crop","signup_url":"#","details_url":"#"},
    {"title":"Trondheim City Trail","date":"2025-05-18","location":"Bymarka, Trondheim","region":"Trøndelag","distances":["8K","16K"],"image":"https://images.unsplash.com/photo-1520975922203-b85e66f2aa64?q=80&w=1200&auto=format&fit=crop","signup_url":"#","details_url":"#"},
    {"title":"Stavanger Strand 5K","date":"2025-06-07","location":"Stavanger sentrum","region":"Rogaland","distances":["5K"],"image":"https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?q=80&w=1200&auto=format&fit=crop","signup_url":"#","details_url":"#"},
    {"title":"Midnight Sun Half","date":"2025-06-21","location":"Tromsøya","region":"Troms og Finnmark","distances":["21K","10K"],"image":"https://images.unsplash.com/photo-1541625602330-2277a4c46182?q=80&w=1200&auto=format&fit=crop","signup_url":"#","details_url":"#"}
  ]</script>

  <!-- JS: meny, filtrering, liste, kalender, kart, vær -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    // Mobile meny
    document.getElementById('menuBtn').addEventListener('click', ()=>{
      const m=document.getElementById('mobileMenu'); m.classList.toggle('hidden');
    });

    function formatDate(iso){ const d=new Date(iso); return d.toLocaleDateString('no-NO',{year:'numeric',month:'long',day:'numeric'}); }
    const state={all:[],showPast:false,filters:{q:'',month:'',region:''}, view:'list', cal:new Date()};
    function monthKey(d){ return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`; }

    // Stedsoppslag for demo (kan byttes med lat/lng i JSON senere)
    const geo={
      'Oslo': [59.9139,10.7522], 'Bygdøy, Oslo':[59.9036,10.6785], 'Bergen sentrum':[60.39299,5.32415],
      'Bymarka, Trondheim':[63.401,10.276], 'Trondheim':[63.4305,10.3951], 'Stavanger sentrum':[58.9690,5.7331],
      'Tromsøya':[69.6492,18.9553]
    };

    // Pent-url fra sted
    function cityToPentUrl(location){
      if(!location) return null;
      let city = location.split(',')[0].trim();
      const map = {
        'Oslo':'Oslo','Bergen':'Bergen','Bergen sentrum':'Bergen','Stavanger':'Stavanger','Stavanger sentrum':'Stavanger',
        'Trondheim':'Trondheim','Bymarka, Trondheim':'Trondheim','Tromsø':'Tromsø','Tromsøya':'Tromsø'
      };
      if(map[location]) city = map[location];
      const slug = encodeURIComponent(city);
      return `https://www.pent.no/${slug}`;
    }

    // Filtre
    function renderFilters(){
      const months=new Set(); const regions=new Set();
      for(const ev of state.all){ const dd=new Date(ev.date); if(!isNaN(dd)) months.add(monthKey(dd)); if(ev.region) regions.add(ev.region); }
      const monthSel=document.getElementById('month'); const regionSel=document.getElementById('region');
      monthSel.querySelectorAll('option:not([value=""])').forEach(o=>o.remove());
      regionSel.querySelectorAll('option:not([value=""])').forEach(o=>o.remove());
      for(const m of Array.from(months).sort()){ const [y,mm]=m.split('-'); const o=document.createElement('option'); o.value=m; o.textContent=new Date(`${y}-${mm}-01`).toLocaleDateString('no-NO',{month:'long',year:'numeric'}); monthSel.appendChild(o); }
      for(const r of Array.from(regions).sort()){ const o=document.createElement('option'); o.value=r; o.textContent=r; regionSel.appendChild(o); }
    }

    function filtered(){
      const today=new Date(); today.setHours(0,0,0,0);
      let list=[...state.all];
      if(!state.showPast) list=list.filter(e=>new Date(e.date)>=today);
      if(state.filters.q){ const q=state.filters.q.toLowerCase(); list=list.filter(e=>`${e.title} ${e.location}`.toLowerCase().includes(q)); }
      if(state.filters.month){ list=list.filter(e=>monthKey(new Date(e.date))===state.filters.month); }
      if(state.filters.region){ list=list.filter(e=>e.region===state.filters.region); }
      return list.sort((a,b)=>new Date(a.date)-new Date(b.date));
    }

    // Listevisning med "Se vær"
    function renderList(){
      const items=filtered(); const grid=document.getElementById('eventsGrid'); const empty=document.getElementById('eventsEmpty');
      grid.innerHTML=''; document.getElementById('eventsSummary').textContent=`Viser ${items.length} arrangementer`;
      if(items.length===0){ empty.classList.remove('hidden'); return; } else empty.classList.add('hidden');

      items.forEach((ev, idx)=>{
        const cardId=`card-${idx}`;
        const el=document.createElement('article'); el.className='rounded-2xl bg-white shadow overflow-hidden';
        el.innerHTML=`<img src="${ev.image}" alt="${ev.title}" class="h-44 w-full object-cover" loading="lazy"/>
          <div class='p-6'><div class='text-xs uppercase tracking-wide text-slate-500'>${ev.region||''}</div>
          <h3 class='text-xl font-semibold mt-1'>${ev.title}</h3>
          <p class='text-sm text-slate-600 mt-1'>${formatDate(ev.date)} • ${ev.location}</p>
          <p class='text-sm mt-2'>${(ev.distances||[]).join(', ')}</p>
          <div class='mt-3 flex flex-wrap gap-3'>
            ${ev.signup_url?`<a href='${ev.signup_url}' class='btn-brand rounded-full px-4 py-2 text-white text-sm font-semibold'>Meld deg på</a>`:''}
            ${ev.details_url?`<a href='${ev.details_url}' class='rounded-full border px-4 py-2 text-sm font-semibold hover:bg-slate-50'>Les mer</a>`:''}
            <button class="rounded-full border px-4 py-2 text-sm font-semibold hover:bg-slate-50"
              onclick="showWeather('${cardId}','${(ev.location||'').replace(/'/g,'’')}')">Se vær</button>
          </div>
          <div id='${cardId}-weather' class='mt-4 hidden'></div>
        </div>`;
        el.id=cardId;
        grid.appendChild(el);
      });
    }

    function showWeather(cardId, location){
      const box=document.getElementById(`${cardId}-weather`);
      const url=cityToPentUrl(location);
      if(!url){ box.innerHTML=`<p class="text-sm text-slate-600">Fant ikke sted for vær.</p>`; box.classList.remove('hidden'); return; }
      box.innerHTML=`<h4 class="text-lg font-semibold mb-2">Værmelding (${location})</h4>
        <iframe src="${url}" width="100%" height="600" style="border:none; border-radius:10px;" title="Vær fra Pent.no"></iframe>`;
      box.classList.remove('hidden');
      box.scrollIntoView({behavior:'smooth', block:'start'});
    }

    // Kalender
    function daysInMonth(y,m){ return new Date(y, m+1, 0).getDate(); }
    function renderCalendar(){
      const current=new Date(state.cal.getFullYear(), state.cal.getMonth(), 1);
      const y=current.getFullYear(), m=current.getMonth();
      document.getElementById('calTitle').textContent=current.toLocaleDateString('no-NO',{month:'long',year:'numeric'});
      const grid=document.getElementById('calendarGrid'); grid.innerHTML='';
      const wk=['Man','Tir','Ons','Tor','Fre','Lør','Søn'];
      for(const w of wk){ const h=document.createElement('div'); h.className='text-xs font-semibold text-slate-500 text-center'; h.textContent=w; grid.appendChild(h); }
      const firstDow=(new Date(y,m,1).getDay()+6)%7;
      const dim=daysInMonth(y,m);
      for(let i=0;i<firstDow;i++){ const d=document.createElement('div'); d.className='p-2'; grid.appendChild(d); }
      const items=filtered();
      for(let day=1; day<=dim; day++){
        const cell=document.createElement('div'); cell.className='rounded-xl bg-white shadow p-2 min-h-[84px]';
        const label=document.createElement('div'); label.className='text-sm font-semibold'; label.textContent=String(day); cell.appendChild(label);
        const dateStr= new Date(y,m,day).toISOString().slice(0,10);
        const todays = items.filter(e=> e.date===dateStr || new Date(e.date).toDateString()===new Date(dateStr).toDateString());
        for(const ev of todays){ const a=document.createElement('div'); a.className='mt-1 text-xs'; a.textContent=`${ev.title}`; cell.appendChild(a); }
        grid.appendChild(cell);
      }
    }

    // Kart
    let map, markersLayer;
    function ensureMap(){
      if(map) return;
      map=L.map('map');
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution:'© OpenStreetMap' }).addTo(map);
      markersLayer=L.layerGroup().addTo(map);
    }
    function renderMap(){
      ensureMap(); markersLayer.clearLayers();
      const items=filtered();
      const points=[];
      const geoLookup=(loc)=> geo[loc] || geo[(loc||'').split(',')[0]] || null;
      for(const ev of items){
        let latlng = (ev.lat && ev.lng) ? [ev.lat, ev.lng] : geoLookup(ev.location);
        if(!latlng) continue;
        points.push(latlng);
        const m=L.marker(latlng).addTo(markersLayer);
        m.bindPopup(`<strong>${ev.title}</strong><br>${formatDate(ev.date)} • ${ev.location}<br>${(ev.distances||[]).join(', ')}${ev.signup_url?`<br><a href='${ev.signup_url}' target='_blank' rel='noopener'>Meld deg på</a>`:''}`);
      }
      if(points.length){ const b=L.latLngBounds(points); map.fitBounds(b, {padding:[30,30]}); }
      setTimeout(()=>map.invalidateSize(), 0);
    }

    // Last data
    async function loadEvents(){
      try{ const r=await fetch('arrangementer.json'); if(!r.ok) throw 0; state.all=await r.json(); }
      catch{ state.all=JSON.parse(document.getElementById('events-seed').textContent); }
      renderFilters(); setView('list');
    }

    // Tab-kontroll og hendelser
    function setView(v){
      state.view=v;
      ['list','cal','map'].forEach(id=>{
        document.getElementById(`tab-${id}`).setAttribute('aria-selected', String(id===v));
        document.getElementById(`panel-${id}`).hidden = id!==v;
      });
      if(v==='list') renderList();
      if(v==='cal') renderCalendar();
      if(v==='map') renderMap();
    }

    document.addEventListener('DOMContentLoaded',()=>{
      document.getElementById('year').textContent=new Date().getFullYear();
      loadEvents();

      // filter-handlers
      document.getElementById('q').addEventListener('input',e=>{state.filters.q=e.target.value; setView(state.view);});
      document.getElementById('month').addEventListener('change',e=>{state.filters.month=e.target.value; setView(state.view);});
      document.getElementById('region').addEventListener('change',e=>{state.filters.region=e.target.value; setView(state.view);});
      document.getElementById('resetFilters').addEventListener('click',()=>{
        state.filters={q:'',month:'',region:''}; q.value=''; month.value=''; region.value=''; setView(state.view);
      });
      document.getElementById('togglePast').addEventListener('click',e=>{
        state.showPast=!state.showPast;
        e.currentTarget.setAttribute('aria-pressed', String(state.showPast));
        e.currentTarget.textContent= state.showPast? 'Skjul tidligere løp':'Vis tidligere løp';
        setView(state.view);
      });

      // tab-handlers
      document.getElementById('tab-list').addEventListener('click',()=>setView('list'));
      document.getElementById('tab-cal').addEventListener('click',()=>setView('cal'));
      document.getElementById('tab-map').addEventListener('click',()=>setView('map'));
      document.getElementById('calPrev').addEventListener('click',()=>{ state.cal.setMonth(state.cal.getMonth()-1); renderCalendar(); });
      document.getElementById('calNext').addEventListener('click',()=>{ state.cal.setMonth(state.cal.getMonth()+1); renderCalendar(); });
    });
  </script>
</body>
</html>
